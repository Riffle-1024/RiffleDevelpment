//
//  ViewController.m
//  MyProject
//
//  Created by mxchip on 2021/9/6.
//

#import "ViewController.h"
#import <dlfcn.h>
#import <libkern/OSAtomic.h>
#include <stdlib.h>
#import "Aspects.h"
#import "HomeViewController.h"
#import "HeadView.h"
#import "UIColor+Hex.h"
#import "RippleView.h"
#import "WaterWaveView.h"
#import <WebKit/WebKit.h>
#import "XibShowView.h"
#import "RiffleCollectionViewController.h"

#define kHexColor(a,b) [UIColor colorWithHexString:a alpha:b]
#define JSMessageName_PrivacyPolicy @"jumpPrivacyPolicy"
#define JSMessageName_Protocol @"jumpUserProtocol"

typedef void(^CallBack) (void);

@interface ViewController ()<WKUIDelegate,WKNavigationDelegate,WKScriptMessageHandler>

@property(nonatomic,copy)CallBack callBack;

@property(nonatomic,strong)WKWebView *webView;


@property(nonatomic,copy) NSString * startTime;
@property(nonatomic,copy) NSString * endTime;

@end

@implementation ViewController

+ (void)load
{
    //    NSLog(@"[ViewController load]");
}

-(void)getDateWithComplete:(void(^)(NSString * message))comPlete
{
    
}
- (void)viewDidLoad {
    [super viewDidLoad];
    //    start : NSLog(@"goto start");
    // Do any additional setup after loading the view.
//    self.startTime = [self getCurrentHourAndMinuteTime];
//    [self moveDiskAmount:7 Object1:@"A" Object2:@"B" Object3:@"C"];
//    self.endTime = [self getCurrentHourAndMinuteTime];
//    double diffentTime = [self getTimeDifferenceWithStartTime:self.startTime andEndTime:self.endTime];
//    NSLog(@"Ê±âËØ∫Â°îÊâßË°åÊó∂Èó¥Ôºö%lfÁßí",diffentTime/1000);
    
//    XibShowView * showView = [[[NSBundle mainBundle] loadNibNamed:@"XibShowView" owner:self options:nil] lastObject];
//    showView.frame  = CGRectMake(10, 200, 300, 400);
//    [self.view addSubview:showView];
//    
//    return;
    self.view.backgroundColor = [UIColor whiteColor];
    
    UIButton * nextBtn = [[UIButton alloc] initWithFrame:CGRectMake(100, 100, 100, 30)];
    [nextBtn addTarget:self action:@selector(nextVC) forControlEvents:UIControlEventTouchUpInside];
    nextBtn.backgroundColor = [UIColor redColor];
    [self.view addSubview:nextBtn];
    
    // WKWebView ÁΩëÈ°µÂä†ËΩΩ
//            NSString* path = [[NSBundle mainBundle] pathForResource:@"index" ofType:@"html"];
//            NSURL* url = [NSURL fileURLWithPath:path];
//            NSURLRequest* request = [NSURLRequest requestWithURL:url] ;
//
//    [self.webView loadRequest:request];
//
    [self.view addSubview:self.webView];
    
    NSString *filePath = [[NSBundle mainBundle] pathForResource:@"myproject" ofType:@"html" inDirectory:@"Html"];
    NSString * basePath = @"Html";
    NSURL *tmpRoot = [NSURL fileURLWithPath:basePath isDirectory:YES];
     NSURL *pathURL = [NSURL fileURLWithPath:filePath];
      [_webView loadRequest:[NSURLRequest requestWithURL:pathURL]];
//    [self.webView loadFileURL:pathURL allowingReadAccessToURL:tmpRoot];
    
    //    goto start;
    
    //    WaterWaveView * headView = [[WaterWaveView alloc] initWithFrame:CGRectMake(50, 300, 280, 280)];
    //    headView.waveColor=kHexColor(@"398AE5", 1.0);
    //    headView.maskColor=kHexColor(@"398AE5", 0.5);
    //    headView.percent = 0.35;
    //    headView.waveSpeed = 0.05;
    //    headView.peak = 8;
    //    [self.view addSubview:headView];
    //    [headView startWave];
    //
    //    return;
    //    HeadView * headView = [[HeadView alloc] initWithFrame:CGRectMake(50, 300, 280, 280)];
    //    headView.firstWaveColor=kHexColor(@"398AE5", 1.0);
    //    headView.secondWaveColor=kHexColor(@"398AE5", 0.5);
    //    headView.percent = 0.35;
    //    headView.speed = 0.05;
    //    headView.peak = 8;
    //    headView.period=2;
    ////    [self.view addSubview:headView];
    //    [headView startWave];
    
    //    SwiftRippleView * rippleView = [[SwiftRippleView alloc] initWithFrame:CGRectMake(186, 300, 3, 3)];
    //    [self.view addSubview:rippleView];
    
    //    RippleView * rippleView = [[RippleView alloc]initWithFrame:CGRectMake(186, 300, 3, 3)];
    //    [self.view addSubview:rippleView];
    
    //    [ViewController aspect_hookSelector:@selector(loadData) withOptions:AspectPositionAfter usingBlock:^(id<AspectInfo> aspectInfo) {
    //        NSLog(@"ÁªüËÆ°‰∫ÜloadDataÊñπÊ≥ï");
    //        NSLog(@"üòÇüòÇüòÇDealloc:---->: %@", NSStringFromClass([aspectInfo.instance class]));
    //    }error:nil];
    
    //    [self performSelector:@selector(expectionTest) withObject:nil afterDelay:3.0];
    //    [self stackViewTest];
    //    [self testMethod];
    //    [self loadData];
    int a = 20;//00010100
    int b = 80;//01010000
    //01000100
    //64+4=68
    //    int b = a<<2;
    //    int c = a | 1;
    //    int d = ~a;
    //    int e = a ^ 1;;
    a ^= b;
    NSLog(@"------:%d",a);
    b = a ^ b;//01000100
    //01010000
    //00010100
    NSLog(@"------:%d",b);
    a = a ^ b;//01000100
    //00010100
    //01010000
    
    //    NSLog(@"------:%d",b);
    //    NSLog(@"------:%d",c);
    //    NSLog(@"------:%d",d);
    //    NSLog(@"------:%d",e);
    NSLog(@"------:%d,%d",a,b);
    short aa = 49;//0000000000110001
    //1111111111001110
    short cc = 0; //1000000000000000
    //0111111111111111
    short dd  = ~cc;
    short bb = ~aa;
    NSLog(@"------:%d",bb);
    NSLog(@"------:%@",[ViewController convertBinarySystemFromDecimalSystem:[NSString stringWithFormat:@"%d",cc]]);
    int ee = 1 << 4;
    NSLog(@"------:%d",ee);
    
    void(^block)(NSString * string) = ^(NSString *string){
        
    };
    
}



#pragma mark ÂçÅËøõÂà∂ËΩ¨‰∫åËøõÂà∂
+ (NSString *)convertBinarySystemFromDecimalSystem:(NSString *)decimal
{
    NSInteger num = [decimal intValue];
    NSInteger remainder = 0;      //‰ΩôÊï∞
    NSInteger divisor = 0;        //Èô§Êï∞
    
    NSString * prepare = @"";
    
    while (true){
        
        remainder = num%2;
        divisor = num/2;
        num = divisor;
        prepare = [prepare stringByAppendingFormat:@"%ld",remainder];
        
        if (divisor == 0){
            
            break;
        }
    }
    
    NSString * result = @"";
    
    for (NSInteger i = prepare.length - 1; i >= 0; i --){
        
        result = [result stringByAppendingFormat:@"%@",
                  [prepare substringWithRange:NSMakeRange(i , 1)]];
    }
    
    return result;
}
- (void)nextVC
{
    
//        HomeViewController * homeVC = [[HomeViewController alloc] init];
//        [self.navigationController pushViewController:homeVC animated:YES];
//        MessageViewController * messageVC = [[MessageViewController alloc] init];
//        [self.navigationController pushViewController:messageVC animated:YES];
//    RiffleCollectionViewController * vc = [[RiffleCollectionViewController alloc] init];
//    [self.navigationController pushViewController:vc animated:YES];
    SwiftCollectionViewController * collectionVC = [[SwiftCollectionViewController alloc] init];
    [self.navigationController pushViewController:collectionVC animated:YES];
    // 1. webviewË∞ÉÁî®JSÂáΩÊï∞, JS‰ª£Á†ÅÂèØÊ†πÊçÆÈúÄË¶ÅÊãºÊé•Â•Ω„ÄÇ
    // Ê≠§Â§ÑÊòØËÆæÁΩÆÈúÄË¶ÅË∞ÉÁî®ÁöÑjsÊñπÊ≥ï‰ª•ÂèäÂ∞ÜÂØπÂ∫îÁöÑÂèÇÊï∞‰º†ÂÖ•ÔºåÈúÄË¶Å‰ª•Â≠óÁ¨¶‰∏≤ÁöÑÂΩ¢Âºè
    // Â∏¶ÂèÇÊï∞
//    NSString *jsFounction = [NSString stringWithFormat:@"callJS('%@')", @"UserProtocol"];
    // ‰∏çÂ∏¶ÂèÇÊï∞
    //    NSString *jsFounction = [NSString stringWithFormat:@"jumpUserProtocol()"];
    // Ë∞ÉÁî®APIÊñπÊ≥ï
//    [self.webView evaluateJavaScript:jsFounction completionHandler:^(id _Nullable result, NSError * _Nullable error) {
//        if (error) {
//            NSLog(@"evaluateJavaScript:\n result = %@ error = %@",result, error);
//        }else{
//            NSLog(@"Ë∞ÉÁî®ÊàêÂäü");
//        }
//    }];
}
- (void)expectionTest
{
    NSArray * myArray = @[@"11111",@"222",@"3333",@"444"];
    
    //    for (int i = 0; i <= myArray.count ; i++) {
    //        NSString * string = [myArray objectAtIndex:i];
    //        NSLog(@"string:%@",string);
    //    }
    @try {
        NSString * string = [myArray objectAtIndex:4];
        NSLog(@"string:%@",string);
    } @catch (NSException *exception) {
        NSLog(@"exception%@",exception);
    } @finally {
        NSLog(@"‰∏çÂÅö‰ªª‰ΩïÂ§ÑÁêÜ");
        return;
    }
}


- (void)stackViewTest
{
    //    NSArray <UIColor *> *colorArray = @[[UIColor redColor],[UIColor blueColor],[UIColor yellowColor],[UIColor purpleColor],[UIColor greenColor],[UIColor orangeColor]];
    //    UIStackView * stackView = [[UIStackView alloc] initWithFrame:CGRectMake(0, 100, self.view.frame.size.width, 360)];
    //    stackView.backgroundColor = [UIColor cyanColor];
    //    [self.view addSubview:stackView];
    //    int count = 150;
    //    for (int i = 0; i < count ; i++) {
    //
    //        CGFloat width = (self.view.frame.size.width/((count + 1)/3.0f + count));
    //        CGFloat space = width/3.0f;
    ////        UIColor * groundColor = [colorArray objectAtIndex:i%colorArray.count];
    //        int x = arc4random() % 255;
    //        int y = arc4random() % 255;
    //        int z = arc4random() % 255;
    //        UIColor * groundColor = [UIColor colorWithRed:x/255.0f green:y/255.0f blue:z/255.0f alpha:1];
    //        UIView * view = [[UIView alloc] initWithFrame:CGRectMake(space + (space + width) * i, 20, width, 320)];
    //        view.backgroundColor = groundColor;
    //        [stackView addSubview:view];
    //    }


    
    
}


- (void)loadData
{
    NSLog(@"%s",__func__);
}

- (void)testMethod
{
    //    NSLog(@"%s",__func__);
}

- (void)btnClicked
{
    self.callBack();
    NSLog(@"%s",__func__);
}


- (void)viewControllCallBack:(void(^)(void))comPlete
{
    self.callBack = comPlete;
}

//ÂéüÂ≠êÈòüÂàó
static OSQueueHead symboList = OS_ATOMIC_QUEUE_INIT;
//ÂÆö‰πâÁ¨¶Âè∑ÁªìÊûÑ‰Ωì
typedef struct{
    void * pc;
    void * next;
}SymbolNode;

- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
    NSMutableArray<NSString *> * symbolNames = [NSMutableArray array];
    //ÈÅçÂéÜÂá∫Èòü
    while (true) {
        //offset ÈÄöËøánextÊåáÈíàÂú®ÁªìÊûÑ‰ΩìÁöÑÂÅèÁßªÈáèÔºåËøõËÄåÁü•ÈÅìnextÁöÑÊåáÂêë
        //offsetof Â∞±ÊòØÈíàÂØπÊüê‰∏™ÁªìÊûÑ‰ΩìÊâæÂà∞Êüê‰∏™Â±ûÊÄßÁõ∏ÂØπËøô‰∏™ÁªìÊûÑ‰ΩìÁöÑÂÅèÁßªÈáè
        // offsetof(SymbolNode, next) ÂèØ‰ª•ÊõøÊç¢‰∏∫ 8
        SymbolNode * node = OSAtomicDequeue(&symboList, offsetof(SymbolNode, next));
        if (node == NULL) break;
        Dl_info info;
        dladdr(node->pc, &info);
        
        NSString * name = @(info.dli_sname);
        
        // Ê∑ªÂä† _
        BOOL isObjc = [name hasPrefix:@"+["] || [name hasPrefix:@"-["];
        NSString * symbolName = isObjc ? name : [@"_" stringByAppendingString:name];
        
        //ÂéªÈáç
        if (![symbolNames containsObject:symbolName]) {
            [symbolNames addObject:symbolName];
        }
    }
    
    //ÂèñÂèç
    NSArray * symbolAry = [[symbolNames reverseObjectEnumerator] allObjects];
    NSLog(@"%@",symbolAry);
    
    //Â∞ÜÁªìÊûúÂÜôÂÖ•Âà∞Êñá‰ª∂
    NSString * funcString = [symbolAry componentsJoinedByString:@"\n"];
    NSString * filePath = [NSTemporaryDirectory() stringByAppendingPathComponent:@"Myproject.order"];
    NSData * fileContents = [funcString dataUsingEncoding:NSUTF8StringEncoding];
    BOOL result = [[NSFileManager defaultManager] createFileAtPath:filePath contents:fileContents attributes:nil];
    if (result) {
        NSLog(@"%@",filePath);
    }else{
        NSLog(@"Êñá‰ª∂ÂÜôÂÖ•Âá∫Èîô");
    }
}




void __sanitizer_cov_trace_pc_guard_init(uint32_t *start,
                                         uint32_t *stop) {
    static uint64_t N;  // Counter for the guards.
    if (start == stop || *start) return;  // Initialize only once.
    //  printf("INIT: %p %p\n", start, stop);
    for (uint32_t *x = start; x < stop; x++)
        *x = ++N;  // Guards should start from 1.
}

void __sanitizer_cov_trace_pc_guard(uint32_t *guard) {
    //  if (!*guard) return;  // Duplicate the guard check.
    
    void *PC = __builtin_return_address(0);
    
    SymbolNode * node = malloc(sizeof(SymbolNode));
    *node = (SymbolNode){PC,NULL};
    
    //ÂÖ•Èòü
    // offsetof Áî®Âú®ËøôÈáåÊòØ‰∏∫‰∫ÜÂÖ•ÈòüÊ∑ªÂä†‰∏ã‰∏Ä‰∏™ËäÇÁÇπÊâæÂà∞ Ââç‰∏Ä‰∏™ËäÇÁÇπnextÊåáÈíàÁöÑ‰ΩçÁΩÆ
    OSAtomicEnqueue(&symboList, node, offsetof(SymbolNode, next));
    
    Dl_info info;
    dladdr(PC, &info);
    
    printf("\nfnameÔºö%s \nfbaseÔºö%p \nsnameÔºö%s\nsaddrÔºö%p \n",info.dli_fname,info.dli_fbase,info.dli_sname,info.dli_saddr);
    char PcDescr[1024];
    //__sanitizer_symbolize_pc(PC, "%p %F %L", PcDescr, sizeof(PcDescr));
    //  printf("guard: %p %x PC %s\n", guard, *guard, PcDescr);
}

#pragma mark ========= lazy load =========
-(WKWebView *)webView {
    if (!_webView) {
        // 2. ÁΩëÈ°µJSË∞ÉÂéüÁîü:
        //   1> ÈúÄË¶ÅÂÖàËÆæÁΩÆ Webview.configuration ÁöÑ userContentController
        //   2> Ê≥®ÂÜåÊñπÊ≥ïÂêç [wkUController addScriptMessageHandler:self name:];
        //   3> ÈÅµÂÆàÂçèËÆÆ<WKScriptMessageHandler>ÔºåÂÆûÁé∞ÂÖ∂ÊñπÊ≥ï.
        //   4> Âú®ÊéßÂà∂Âô®ÈîÄÊØÅÊó∂ÔºåÈúÄË¶ÅÁßªÈô§ÊñπÊ≥ïÂêçÊ≥®ÂÜå
        
        /*! ËÆæÁΩÆÁΩëÈ°µÁöÑÈÖçÁΩÆÊñá‰ª∂ */
        WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];
        /*! ÂÖÅËÆ∏ËßÜÈ¢ëÊí≠Êîæ */
        configuration.allowsAirPlayForMediaPlayback = YES;
        /*! ÂÖÅËÆ∏Âú®Á∫øÊí≠Êîæ */
        configuration.allowsInlineMediaPlayback = YES;
        /*! ÂÖÅËÆ∏ÂèØ‰ª•‰∏éÁΩëÈ°µ‰∫§‰∫íÔºåÈÄâÊã©ËßÜÂõæ */
        configuration.selectionGranularity = YES;
        /*! webÂÜÖÂÆπÂ§ÑÁêÜÊ±† */
        configuration.processPool = [[WKProcessPool alloc] init];
        /*! Ëá™ÂÆö‰πâÈÖçÁΩÆ,‰∏ÄËà¨Áî®‰∫é jsË∞ÉÁî®ocÊñπÊ≥ï(OCÊã¶Êà™URL‰∏≠ÁöÑÊï∞ÊçÆÂÅöËá™ÂÆö‰πâÊìç‰Ωú) */
        WKUserContentController *wkUController = [[WKUserContentController alloc] init];
        /*! Ëá™ÈÄÇÂ∫îÂ±èÂπïÂÆΩÂ∫¶,Ê≥®ÂÖ•js */
        NSString *jSString = @"var meta = document.createElement('meta'); meta.setAttribute('name', 'viewport'); meta.setAttribute('content', 'width=device-width,user-scalable=no'); document.getElementsByTagName('head')[0].appendChild(meta); var lastDiv = document.createElement('div');lastDiv.id = 'last-div'; document.getElementsByTagName('body')[0].appendChild(lastDiv)";
        WKUserScript *wkUserScript = [[WKUserScript alloc] initWithSource:jSString injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:YES];
        [wkUController addUserScript:wkUserScript];
        /*! ÂÖÅËÆ∏Áî®Êà∑Êõ¥ÊîπÁΩëÈ°µÁöÑËÆæÁΩÆ */
        configuration.userContentController = wkUController;
        //JSË∞ÉÁî®OC Ê∑ªÂä†Â§ÑÁêÜËÑöÊú¨
        [wkUController addScriptMessageHandler:self name:JSMessageName_Protocol];
        [wkUController addScriptMessageHandler:self name:JSMessageName_PrivacyPolicy];
        
        // ËøõË°åÂÅèÂ•ΩËÆæÁΩÆ
        //        WKPreferences *preferences = [WKPreferences new];
        //        preferences.javaScriptCanOpenWindowsAutomatically = YES;
        //        preferences.minimumFontSize = 40.0;
        //        configuration.preferences = preferences;
        
        CGRect frame = CGRectMake(0, 200, 375,400);
        _webView = [[WKWebView alloc] initWithFrame:frame configuration:configuration];
        _webView.navigationDelegate = self;
        _webView.scrollView.showsHorizontalScrollIndicator = NO;
        _webView.backgroundColor = [UIColor orangeColor];
    }
    return _webView;
}


#pragma mark - WKScriptMessageHandler
- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {
    
    if ([message.name isEqualToString:JSMessageName_Protocol]) {
        NSLog(@"********Áî®Êà∑ÂçèËÆÆ********");
        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"Áî®Êà∑ÂçèËÆÆjs‰º†ÈÄíËøáÊù•ÁöÑÂèÇÊï∞"message:[NSString stringWithFormat:@"ÊñπÊ≥ïÂêçÔºö%@\n\nÂèÇÊï∞Ôºö%@",message.name,message.body] preferredStyle:UIAlertControllerStyleAlert];
        [alertController addAction:[UIAlertAction actionWithTitle:@"Á°ÆÂÆö" style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) {
            
        }]];
        [[[UIApplication sharedApplication] windows].firstObject.rootViewController presentViewController:alertController animated:YES completion:^{
            
        }];
    }else if ([message.name isEqualToString:JSMessageName_PrivacyPolicy]){
        NSLog(@"********ÈöêÁßÅÊîøÁ≠ñ********");
        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"ÈöêÁßÅÊîøÁ≠ñjs‰º†ÈÄíËøáÊù•ÁöÑÂèÇÊï∞"message:[NSString stringWithFormat:@"ÊñπÊ≥ïÂêçÔºö%@\n\nÂèÇÊï∞Ôºö%@",message.name,message.body] preferredStyle:UIAlertControllerStyleAlert];
        [alertController addAction:[UIAlertAction actionWithTitle:@"Á°ÆÂÆö" style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) {
            
        }]];
        [[[UIApplication sharedApplication] windows].firstObject.rootViewController presentViewController:alertController animated:YES completion:^{
            
        }];
    }
}



-(void)moveDiskAmount:(NSInteger )amount Object1:(NSString *)object1 Object2:(NSString *)object2 Object3:(NSString *)object3{
    if (amount == 1) {
        [self moveOject1:object1 toObject3:object3];
    }else{
        [self moveDiskAmount:amount - 1 Object1:object1 Object2:object3 Object3:object2];
        [self moveOject1:object1 toObject3:object3];
        [self moveDiskAmount:amount - 1 Object1:object2 Object2:object1 Object3:object3];
    }
}

-(void)moveOject1:(NSString *)object1 toObject3:(NSString *)object3{
    NSLog(@"%@‚Äî‚Äî>%@",object1,object3);
}

//Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥
-(NSString * )getCurrentHourAndMinuteTime{
    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
    // ËÆæÁΩÆÊÉ≥Ë¶ÅÁöÑÊ†ºÂºèÔºåhh‰∏éHHÁöÑÂå∫Âà´:ÂàÜÂà´Ë°®Á§∫12Â∞èÊó∂Âà∂,24Â∞èÊó∂Âà∂
    [formatter setDateFormat:@"yyyyMMddHHmmssSSS"];
    NSDate *dateNow = [NSDate date];
    //ÊääNSDateÊåâformatterÊ†ºÂºèËΩ¨ÊàêNSString
    NSString *currentTime = [formatter stringFromDate:dateNow];
    return currentTime;
    
}

//Ëé∑Âèñ‰∏§‰∏™Êó∂Èó¥ÁÇπÁöÑÊó∂Èó¥Â∑ÆÔºåÁ≤æÁ°ÆÂà∞ÊØ´Áßí
-(double )getTimeDifferenceWithStartTime:(NSString * )startTime andEndTime:(NSString *)endTime{
    NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
    [dateFormatter setDateFormat:@"yyyyMMddHHmmssSSS"];
    NSDate* startTimeData = [dateFormatter dateFromString:startTime];
    NSTimeInterval startTimeSp=[startTimeData timeIntervalSince1970]*1000;// *1000 ÊòØÁ≤æÁ°ÆÂà∞ÊØ´ÁßíÔºå‰∏ç‰πòÂ∞±ÊòØÁ≤æÁ°ÆÂà∞Áßí
    NSDate* endTimeData = [dateFormatter dateFromString:endTime];
    NSTimeInterval endTimeSp=[endTimeData timeIntervalSince1970]*1000;
    double difference = (endTimeSp - startTimeSp);
    //    self.serviceTotalTime += difference/1000;//‰∫ëÁ´ØÊó∂Èó¥
    //    NSString * differenceStr = [NSString stringWithFormat:@"%.3f",difference/1000];
    NSLog(@"ÂºÄÂßãÊó∂Èó¥Ôºö%@ÔºåÁªìÊùüÊó∂Èó¥Ôºö%@",startTime,endTime);
    return difference;
    
}
@end
